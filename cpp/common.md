## 一般C++编程
### 全局变量
- 用函数返回值初始化全局变量/初始化对象从而调用构造函数是在main开始之前执行代码的方法。但要注意不同全局变量之间的初始化顺序是**不确定**的，小心相互依赖。
- 全局变量之可以定义一次，对应只分配一次全局区内存。多个文件中多次定义全局变量会导致重定义错误（除非使用static限定链接性）。但多个文件中使用全局变量要**声明**，语法是常规声明前面加extern如`extern int a`。声明要求本质上源于文件是*最小的编译单元*。
- 重定义的问题主要出现于在头文件中定义全局变量的做法。
- 函数定义有类似的问题，不要在头文件定义函数。
- 对于全局变量，正确做法是在头文件中写*声明*，在源文件中*定义*，然后链接
- 对于全局函数，两种做法：
  1. 头文件中*声明*，源文件中*定义*（标准做法）
  2. static定义
  3. inline（inline函数具有文件内的链接性）

### 列表初始化
C++11允许采用形如
```cpp
vector<int> vec = {1, 2, 3, 4};
map<int, string> = { {1, "a"}, {2, "b"} };
```
的列表初始化语法来初始化STL容器，可以大大方便容器的初始化。（上述语法中的等号可以省略）
还可以作为参数传递：
```cpp
map<int, string> mp;
mp.insert({3, "c"});
```

这种用法的奥秘在于：
1. 编译器的支持
2. initialize_list模板类支持变长的、任意类型的序列（尤其用于map这种每个项类型不一样的东西）

### 宏
宏可以用于移除一些重复代码，可以代码生成（语言体系内部不可替代），甚至用来编写DSL（慎）
用法：
- 分为一般宏和带参数宏
- 宏定义结尾不用写分号（如写上分号则当作是**宏体的一部分**），**一个宏定义只能写一行，多行情形必须加行连符号**
- 一般宏：
  - 使用`#define 宏名 宏体`定义
  - 宏体可以省略，常结合`#ifdef` `#ifndef`使用
  - 有部分预定义的宏如`__LINE__``__FILE__`分别表示所在行号、处理的文件名等
  - 可以由外部（如CMake等编译系统）传入用以在预处理阶段搞事（如条件编译）
- 带参数宏：
  - #的特殊用法：
  ```cpp
  #define STR(s) #s // 替换为"s"
  #define CONCAT(a,b) a##b // 替换为ab（连接起来）
  ```
  - 参数为宏时，这个宏会继续展开；特别地，宏体包含#用法时参数中的宏不会再展开，但可以通过一层间接宏来展开
  - 一个综合运用：
  ```cpp
  #define ___ANONYMOUS1(type, var, line) type var##line  
  #define __ANONYMOUS0(type,  line) ___ANONYMOUS1(type, _anonymous, line)  
  #define ANONYMOUS(type) __ANONYMOUS0(type, __LINE__)
  // 假设在第70行，ANONYMOUS(static int)展开为 static int _anonymous70
  ```
